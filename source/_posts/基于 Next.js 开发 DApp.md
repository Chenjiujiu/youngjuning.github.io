---
title: 基于 Next.js 开发 DApp
date: 2021-12-05 22:58:44
cover: https://cdn.jsdelivr.net/gh/youngjuning/images/202112101016728.png
categories:
  - 前端
tags:
  - Next.js
  - ethereum
---

## 项目初始化

```sh
npx create-next-app@latest --typescript
```

安装完成后，根据指示开启开发模式的 server。然后尝试编辑 `pages/index.tsx` 并在浏览器查看结果。

## commitlint

```sh
npx @luozhu/create-commitlint
```

## prettier

### 安装依赖

```sh
yarn add prettier eslint-config-prettier eslint-plugin-prettier @luozhu/prettier-config -D
```

### 配置 .eslintrc.json

```json
{
  "extends": ["next/core-web-vitals", "plugin:prettier/recommended", "prettier"],
  "rules": {
    "no-unused-vars": 1,
    "react-hooks/exhaustive-deps": 0,
    "@next/next/no-img-element": 0
  }
}
```

### 配置 .prettierrc.js

```js
module.exports = require('@luozhu/prettier-config');
```

## lint-staged

在 `package.json` 文件中如下配置即可：

```json
{
  "gitHooks": {
    "pre-commit": "lint-staged",
    "commit-msg": "commitlint -e -V"
  },
  "lint-staged": {
    "**/*.{js,jsx,ts,tsx}": [
      "eslint --fix"
    ],
    "**/*.{md,json}": [
      "prettier --write"
    ]
  }
}
```

## 基于根目录导入模块

`baseUrl` 配置选项允许您直接从项目的根目录导入。

```json
// tsconfig.json or jsconfig.json
{
  "compilerOptions": {
    "baseUrl": "."
  }
}
```

## antd

### 安装依赖

```sh
yarn add antd
```

### 引入 css

在 `pages/_app.tsx` 中引入 css

```tsx
import 'antd/dist/antd.css'
```

### 测试

```diff
import type { NextPage } from 'next';
import Head from 'next/head';
import Image from 'next/image';
+ import { DatePicker } from 'antd';
import styles from '../styles/Home.module.css';

const Home: NextPage = () => {
  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.png" />
      </Head>

      <main className={styles.main}>
+        <DatePicker />
      </main>

      <footer className={styles.footer}>
        <a
          href="https://vercel.com?utm_source=create-next-app&utm_medium=default-template&utm_campaign=create-next-app"
          target="_blank"
          rel="noopener noreferrer"
        >
          Powered by{' '}
          <span className={styles.logo}>
            <Image src="/vercel.svg" alt="Vercel Logo" width={72} height={16} />
          </span>
        </a>
      </footer>
    </div>
  );
};

export default Home;
```

在页面中看到如下页面就算完成了集成：

![](https://cdn.jsdelivr.net/gh/youngjuning/images/202112060018376.png)

## 模块路径别名

在 tsconfig.json 中加入以下配置：

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/components/*": ["./components/*"]
    }
  }
}
```

其他的地址依葫芦画瓢加到 paths 对象中即可。

## 安装 ethers.js

```sh
yarn add ethers.js
```

## 连接 MetaMask

```tsx
import { ethers } from 'ethers';
// ...
useEffect(() => {
  (async () => {
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner();
    await provider.send('eth_requestAccounts', []);
    console.log('Account:', await signer.getAddress());
  })();
}, []);
// ...
```
